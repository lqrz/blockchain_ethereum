//------ unlock the main account

personal.unlockAccount(personal.listAccounts[0])


//------ deploy the user

var userContract = web3.eth.contract([{"constant":false,"inputs":[{"name":"_provider_address","type":"address"}],"name":"register_service","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"services","outputs":[{"name":"active","type":"bool"},{"name":"last_update","type":"uint256"},{"name":"debt","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_debt_amount","type":"uint256"}],"name":"set_debt","outputs":[],"payable":false,"type":"function"},{"inputs":[{"name":"_name","type":"string"}],"payable":false,"type":"constructor"}]);

var user = userContract.new(
   "lqrz",
   {
     from: web3.eth.accounts[0], 
     data: '0x60606040523461000057604051610502380380610502833981016040528080518201919050505b8060009080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061007257805160ff19168380011785556100a0565b828001600101855582156100a0579182015b8281111561009f578251825591602001919060010190610084565b5b5090506100c591905b808211156100c15760008160009055506001016100a9565b5090565b50505b505b610429806100d96000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680627437081461005e57806306fdde03146100915780636d966d0114610127578063b50e9e1814610180575b610000565b346100005761008f600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190505061019d565b005b346100005761009e610237565b60405180806020018281038252838181518152602001915080519060200190808383600083146100ed575b8051825260208311156100ed576020820191506020810190506020830392506100c9565b505050905090810190601f1680156101195780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3461000057610158600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919050506102d5565b6040518084151515158152602001838152602001828152602001935050505060405180910390f35b346100005761019b600480803590602001909190505061030c565b005b6060604051908101604052806001151581526020014281526020016000815250600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008201518160000160006101000a81548160ff02191690831515021790555060208201518160010155604082015181600201559050505b50565b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156102cd5780601f106102a2576101008083540402835291602001916102cd565b820191906000526020600020905b8154815290600101906020018083116102b057829003601f168201915b505050505081565b60016020528060005260406000206000915090508060000160009054906101000a900460ff16908060010154908060020154905083565b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160009054906101000a900460ff16156103f45780600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206002018190555042600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101819055506103f9565b610000565b5b505600a165627a7a723058205b955271046a7be01ee66e2b22ce498e3d15b2e8b9bbb0e4b8f344d4c25b6df50029', 
     gas: '4700000'
   }, function (e, contract){
    console.log(e, contract);
    if (typeof contract.address !== 'undefined') {
         console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
    }
 })


//------ deploy the service

var serviceContract = web3.eth.contract([{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_user_address","type":"address"},{"name":"_debt_amount","type":"uint256"}],"name":"set_debt","outputs":[],"payable":false,"type":"function"},{"inputs":[{"name":"_name","type":"string"}],"payable":false,"type":"constructor"}]);

var service = serviceContract.new(
   "vodafone",
   {
     from: web3.eth.accounts[0], 
     data: '0x6060604052346100005760405161033e38038061033e833981016040528080518201919050505b8060009080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061007257805160ff19168380011785556100a0565b828001600101855582156100a0579182015b8281111561009f578251825591602001919060010190610084565b5b5090506100c591905b808211156100c15760008160009055506001016100a9565b5090565b50505b505b610265806100d96000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806306fdde0314610049578063a1f02a0f146100df575b610000565b346100005761005661011b565b60405180806020018281038252838181518152602001915080519060200190808383600083146100a5575b8051825260208311156100a557602082019150602081019050602083039250610081565b505050905090810190601f1680156100d15780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3461000057610119600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506101b9565b005b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101b15780601f10610186576101008083540402835291602001916101b1565b820191906000526020600020905b81548152906001019060200180831161019457829003601f168201915b505050505081565b60008290508073ffffffffffffffffffffffffffffffffffffffff1663b50e9e18836040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180828152602001915050600060405180830381600087803b156100005760325a03f115610000575050505b5050505600a165627a7a723058204e86c13f0e256df5304fb353b29e5829835ddbc9e09ea060ea0746b15d44bb5e0029', 
     gas: '4700000'
   }, function (e, contract){
    console.log(e, contract);
    if (typeof contract.address !== 'undefined') {
         console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
    }
 })


//------ get the deployed service address from the cmd

var service_address = "0x47525e11d356453de45710618efc449c2fd2cdf1"


//------ register a service (remember to mine afterwards)

user.register_service(service_address, {from: personal.listAccounts[0]})


//------ set a debt for the previous service

service.set_debt("0xf3eb196b18264a395043f80ccd0af464e18e95fa", 500000000000000000, {from: personal.listAccounts[0]})